{% extends "base.html" %}

{% block content %}
<h1>Tasks</h1>

    <!-- Filter links -->
    <div>
        <a href="{{ url_for('tasks', filter='all', search=search, sort=sort, page=1) }}">All</a> |
        <a href="{{ url_for('tasks', filter='active', search=search, sort=sort, page=1) }}">Active</a> |
        <a href="{{ url_for('tasks', filter='completed', search=search, sort=sort, page=1) }}">Completed</a>
    </div>

    <br>

    <!-- Search -->
    <form method = "GET" action="{{ url_for('tasks') }}">
        <input type = "hidden" name = "filter" value = "{{ filter_val }}">
        <input type="hidden" name="sort" value="{{ sort }}">
        <input type = "text" name = "search" placeholder = "Search..." value = "{{ search}}">

        <br>
        <br>

        <button type = "submit">Search</button>
    </form>

    <br>

    <!-- Sort -->
    <form method = "GET" action="{{ url_for('tasks', filter=filter_val, search=search, sort=sort, page=page) }}">
        <input type = "hidden" name = "filter" value = "{{ filter_val }}">
        <input type = "hidden" name = "search" value = "{{ search }}">

        <select name = "sort">
            <option value = "created_desc" {% if sort == "created_desc" %}selected{% endif %}>Newest</option>
            <option value = "created_asc" {% if sort == "created_asc" %}selected{% endif %}>Oldest</option>
            <option value = "title_asc" {% if sort == "title_asc" %}selected{% endif %}>Title A-Z</option>
            <option value = "title_desc" {% if sort == "title_desc" %}selected{% endif %}>Title Z-A</option>
        </select>

        <br>
        <br>

        <button type = "submit">Sort</button>
    </form>

    <hr>

    <!-- Add Task -->
    <form method = "POST" action = "{{ url_for('tasks') }}">
        <input type = "text" name = "title" placeholder = "Enter a task" required>
        <br>
        <br>
        <textarea name = "notes" rows = "2" cols = "40" placeholder = "Notes"></textarea>
        <br>
        <br>
        <button type = "submit">Add task</button>
    </form>

    <hr>

<ul>
    {% for task in tasks %}
        <li>
            {% if task["completed"] %}
             <s>
                <a href="{{ url_for('task_detail', task_id=task['id']) }}">
                    {{ task["title"] }}
                </a>                
                <small>({{ task["created_at"] }})</small>
            </s>
            {% else %}
                <a href="{{ url_for('task_detail', task_id=task['id']) }}">
             {{ task["title"] }}
                </a>
                <small>({{ task["created_at"] }})</small>
            {% endif %}

            {% if task["notes"] %}
                <div><em>{{ task["notes"] }}</em></div>
            {% endif %}
            
            <!-- Toggle complete -->
            <form method = "POST" action = "{{ url_for('toggle_task', task_id = task['id']) }}" style = "display:inline;">
                <button type = "submit">
                    {% if task["completed"] %}Uncomplete{% else %}Complete{% endif %}
                </button>
            </form>

            <!-- DELETE -->
            <a href="{{ url_for('confirm_delete', task_id = task['id']) }}">Delete</a>

            <!-- EDIT -->
            <a href="{{ url_for('edit_task', task_id=task['id']) }}">Edit</a>
        </li>
    {% endfor %}
</ul>

<!-- Pagination -->
<div style = "margin-top: 12px;">
    {% if total_pages > 1 %}
    <div>
        Page {{ page }} of {{ total_pages }}
        <small>({{ total }} tasks)</small>
    </div>

    <div style = "margin-top: 6px;">
        {% if page > 1 %}
            <a href="{{ url_for('tasks', page=page-1, filter=filter_val, search=search, sort=sort) }}">Prev</a>
        {% endif %}
        
        {% if page < total_pages %}
            {% if page > 1 %} | {% endif %}
            <a href="{{ url_for('tasks', page=page+1, filter=filter_val, search=search, sort=sort) }}">Next</a>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}